-- Library Script (InviteLibrary.lua)
local Module = {}

-- Function to fetch the server icon using Discord's API
local function getServerIcon(inviteLink)
    -- Extract the server ID from the invite link
    local serverID = inviteLink:match("discord%.gg/(%w+)")
    if serverID then
        -- Get the icon from Discord API; replace 'icon.png' with the actual icon hash
        return "https://cdn.discordapp.com/icons/" .. serverID .. "/icon.png"
    end
    return "rbxasset://textures/ui/GuiImagePlaceholder.png" -- Default image if extraction fails
end

-- Function to display the invite prompt
function Module.Prompt(data)
    -- Check if "invite" is provided
    if not data.invite then
        error("Invite link is required!")
    end

    -- Create the GUI elements
    local Inviter = Instance.new("ScreenGui")
    local InviteGUI = Instance.new("Frame")
    local UICorner = Instance.new("UICorner")
    local ServerIcon = Instance.new("ImageLabel")
    local UICorner_2 = Instance.new("UICorner")
    local invited = Instance.new("TextLabel")
    local Servername = Instance.new("TextLabel")
    local accept = Instance.new("TextButton")
    local UICorner_3 = Instance.new("UICorner")
    local decline = Instance.new("TextButton")

    -- GUI Properties
    Inviter.Name = "Inviter"
    Inviter.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    Inviter.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

    InviteGUI.Name = "InviteGUI"
    InviteGUI.Parent = Inviter
    InviteGUI.BackgroundColor3 = Color3.fromRGB(49, 51, 56)
    InviteGUI.BorderSizePixel = 0
    InviteGUI.Size = UDim2.new(0, 300, 0, 200)  -- Adjust size as needed
    InviteGUI.Position = UDim2.new(0.5, -150, 0.5, -100) -- Centered

    UICorner.Parent = InviteGUI

    ServerIcon.Name = "ServerIcon"
    ServerIcon.Parent = InviteGUI
    ServerIcon.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    ServerIcon.Size = UDim2.new(0, 100, 0, 100)
    ServerIcon.Position = UDim2.new(0.5, -50, 0.1, 0) -- Centered
    -- Use the server image based on the invite link
    ServerIcon.Image = getServerIcon(data.invite)

    UICorner_2.CornerRadius = UDim.new(0, 15)
    UICorner_2.Parent = ServerIcon

    invited.Name = "invited"
    invited.Parent = InviteGUI
    invited.BackgroundTransparency = 1.000
    invited.Position = UDim2.new(0.5, -85, 0.5, -20) -- Centered
    invited.Size = UDim2.new(0, 170, 0, 34)
    invited.Font = Enum.Font.SourceSans
    invited.Text = "You've been invited to join"
    invited.TextColor3 = Color3.fromRGB(214, 214, 214)
    invited.TextScaled = true
    invited.TextWrapped = true

    Servername.Name = "Servername"
    Servername.Parent = InviteGUI
    Servername.BackgroundTransparency = 1.000
    Servername.Position = UDim2.new(0.5, -95, 0.5, 20) -- Centered
    Servername.Size = UDim2.new(0, 191, 0, 50)
    Servername.Font = Enum.Font.SourceSans
    -- Set the server name, or default text if not provided
    Servername.Text = data.name or "SERVERNAME"
    Servername.TextColor3 = Color3.fromRGB(255, 255, 255)
    Servername.TextScaled = true
    Servername.TextWrapped = true

    accept.Name = "accept"
    accept.Parent = InviteGUI
    accept.BackgroundColor3 = Color3.fromRGB(93, 109, 255)
    accept.Position = UDim2.new(0.2, 0, 0.75, 0)
    accept.Size = UDim2.new(0, 100, 0, 35)
    accept.Font = Enum.Font.SourceSans
    accept.Text = "Accept Invite"
    accept.TextColor3 = Color3.fromRGB(255, 255, 255)
    accept.TextSize = 20.000
    UICorner_3.Parent = accept

    decline.Name = "decline"
    decline.Parent = InviteGUI
    decline.BackgroundTransparency = 1.000
    decline.Position = UDim2.new(0.2, 0, 0.85, 0)
    decline.Size = UDim2.new(0, 100, 0, 15)
    decline.Font = Enum.Font.SourceSans
    decline.Text = "No Thanks"
    decline.TextColor3 = Color3.fromRGB(255, 255, 255)
    decline.TextScaled = true
    decline.TextWrapped = true

    -- Button functionality
    -- Copy invite link to clipboard when "Accept Invite" is clicked
    accept.MouseButton1Click:Connect(function()
        setclipboard(data.invite)
        print("Invite link copied to clipboard: " .. data.invite)
    end)

    -- Close the GUI when decline is clicked
    decline.MouseButton1Click:Connect(function()
        Inviter:Destroy() -- Destroys the entire GUI
    end)
end

return Module
